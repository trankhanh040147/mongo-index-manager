# AGENTS.md

This document provides guidance for AI agents working in this codebase.

## About This Project

This is a Go-based backend service for managing MongoDB indexes. It's built with the Fiber web framework and uses MongoDB for data storage and Redis for background job queuing.

## Essential Commands

This project uses a `Makefile` to simplify common tasks. Here are the most important commands:

- `make build`: Build the application binary.
- `make run`: Run the application locally.
- `make test`: Run all tests.
- `make lint`: Run the linter to check for code quality issues.
- `make fmt`: Format the Go code.
- `make deps`: Install or update Go dependencies.
- `make docker-build`: Build the Docker image.
- `make docker-run`: Run the application in a Docker container.

## Code Organization

The codebase is organized into the following directories:

- **`api/`**: Contains the API layer, including:
  - **`controllers/`**: Handles the business logic for each API endpoint.
  - **`routers/`**: Defines the API routes and maps them to controllers.
  - **`middlewares/`**: Contains middleware for tasks like authentication and logging.
  - **`serializers/`**: Defines the data structures for API requests and responses.
- **`common/`**: Contains shared code used throughout the application, such as:
  - **`configure/`**: Handles application configuration from environment variables.
  - **`logging/`**: Configures the `zerolog` logger.
  - **`response/`**: Provides standardized API response and error handling.
- **`database/`**: Contains the database layer, including:
  - **`mongo/`**: Contains MongoDB models and query logic.
- **`job/`**: Contains the logic for background jobs, using the `asynq` library.
- **`utilities/`**: Contains various utility packages, such as JWT handling and job queuing.

## Key Technologies

- **Go**: The programming language used. The project uses Go version 1.25.
- **Fiber**: The web framework used for building the API.
- **MongoDB**: The primary database.
- **Redis**: Used as a message broker for background jobs.
- **`zerolog`**: Used for structured logging.
- **`asynq`**: Used for background job processing.
- **`golang-jwt`**: Used for JWT-based authentication.

## Code Patterns

- **Dependency Injection**: The project uses a simple form of dependency injection by passing dependencies to constructors (e.g., `NewIndex` in `api/routers/index.go`).
- **Separation of Concerns**: The code is well-organized, with a clear separation between the API, business logic, and data access layers.
- **Configuration**: Application configuration is managed through environment variables, which are loaded using the `godotenv` and `env` libraries.
- **Error Handling**: Custom error handling is implemented in the `common/response` package to provide consistent error responses.
- **Validation**: Request body validation is handled in the `serializers` package.

## Testing

To run the test suite, use the following command:

```bash
make test
```

## Gotchas

- **Environment Variables**: The application requires several environment variables to be set for things like database connections and JWT secrets. A `.env` file is likely used for local development, but is not checked into version control.
- **JWT Certificates**: The application uses a public/private key pair for JWT signing. These are generated by the `make generate-certs` command and are not checked into version control.
- **Background Jobs**: The application relies on a running Redis instance for background job processing. Make sure Redis is running before starting the application.
